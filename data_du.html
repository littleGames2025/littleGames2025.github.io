<div class="game-container">
    <h1 class="season-title spring" id="seasonTitle">æ˜¥æ—¥æ•°ç‹¬</h1>
    
    <div class="controls">
        <div class="game-actions">
            <button class="game-btn btn-new" id="newGame">æ–°æ¸¸æˆ</button>
            <button class="game-btn btn-check" id="checkGame">æ£€æŸ¥</button>
            <button class="game-btn btn-hint" id="getHint">æç¤º</button>
        </div>
        
        <div class="season-selector">
            <div class="season-btn season-spring active" data-season="spring" title="æ˜¥"></div>
            <div class="season-btn season-summer" data-season="summer" title="å¤"></div>
            <div class="season-btn season-autumn" data-season="autumn" title="ç§‹"></div>
            <div class="season-btn season-winter" data-season="winter" title="å†¬"></div>
        </div>
    </div>
    
    <div class="stats">
        <div class="stat-box">
            éš¾åº¦: <span class="stat-value" id="difficulty">ä¸­çº§</span>
        </div>
        <div class="stat-box">
            ç”¨æ—¶: <span class="stat-value" id="timer">00:00</span>
        </div>
        <div class="stat-box">
            é”™è¯¯: <span class="stat-value" id="mistakes">0</span>
        </div>
    </div>
    
    <div class="sudoku-board" id="sudokuBoard"></div>
    
    <div class="number-pad" id="numberPad">
        <!-- 1-9 æ•°å­—æŒ‰é’®ç”±JSåŠ¨æ€ç”Ÿæˆ -->
    </div>
    
    <div class="achievements" id="achievements">
        <div class="badge" data-badge="spring" title="æ˜¥å­£å¤§å¸ˆ">ğŸŒ¼</div>
        <div class="badge" data-badge="summer" title="å¤å­£å¤§å¸ˆ">â˜€ï¸</div>
        <div class="badge" data-badge="autumn" title="ç§‹å­£å¤§å¸ˆ">ğŸ‚</div>
        <div class="badge" data-badge="winter" title="å†¬å­£å¤§å¸ˆ">â„ï¸</div>
        <div class="badge" data-badge="perfect" title="å®Œç¾é€šå…³">â­</div>
    </div>
</div>

<script>
    // æ¸¸æˆçŠ¶æ€ç®¡ç†
    const gameState = {
        currentSeason: 'spring',
        difficultyLevel: 'medium',
        board: [],
        solution: [],
        userBoard: [],
        startTime: 0,
        timerInterval: null,
        elapsedTime: 0,
        mistakes: 0,
        selectedCell: null,
        hintsUsed: 0,
        achievements: {
            spring: false,
            summer: false,
            autumn: false,
            winter: false,
            perfect: false
        }
    };

    // DOMå…ƒç´ å¼•ç”¨
    const elements = {
        seasonTitle: document.getElementById('seasonTitle'),
        sudokuBoard: document.getElementById('sudokuBoard'),
        numberPad: document.getElementById('numberPad'),
        particles: document.getElementById('particles'),
        timer: document.getElementById('timer'),
        mistakes: document.getElementById('mistakes'),
        difficulty: document.getElementById('difficulty'),
        newGameBtn: document.getElementById('newGame'),
        checkBtn: document.getElementById('checkGame'),
        hintBtn: document.getElementById('getHint'),
        achievements: document.getElementById('achievements')
    };

    // å­£èŠ‚é…ç½®
    const seasonsConfig = {
        spring: {
            title: 'æ˜¥æ—¥æ•°ç‹¬',
            class: 'spring',
            bg: 'var(--spring)',
            particles: { shape: 'ğŸŒ¸', color: '#ff9a9e', amount: 8 } // å‡å°‘ç²’å­æ•°é‡
        },
        summer: {
            title: 'å¤æ—¥æ•°ç‹¬',
            class: 'summer',
            bg: 'var(--summer)',
            particles: { shape: 'ğŸ’§', color: '#43e97b', amount: 10 }
        },
        autumn: {
            title: 'ç§‹æ—¥æ•°ç‹¬',
            class: 'autumn',
            bg: 'var(--autumn)',
            particles: { shape: 'ğŸ‚', color: '#fa709a', amount: 8 }
        },
        winter: {
            title: 'å†¬æ—¥æ•°ç‹¬',
            class: 'winter',
            bg: 'var(--winter)',
            particles: { shape: 'â„ï¸', color: '#a1c4fd', amount: 10 }
        }
    };

    // åˆå§‹åŒ–æ¸¸æˆ
    function initGame() {
        generateNewBoard();
        createBoardUI();
        setupNumberPad();
        updateTimer();
        updateAchievementsUI();
        
        // å¯åŠ¨è®¡æ—¶å™¨
        startTimer();
        
        // è®¾ç½®å­£èŠ‚ç‰¹æ•ˆ
        changeSeason(gameState.currentSeason);
    }

    // ç”Ÿæˆæ–°çš„æ•°ç‹¬æ£‹ç›˜
    function generateNewBoard() {
        // å®é™…é¡¹ç›®ä¸­ä½¿ç”¨DFSå›æº¯ç®—æ³•ç”Ÿæˆ
        // æ­¤å¤„ä¸ºç¤ºä¾‹æ•°æ®
        const exampleBoard = [
            [5, 3, 0, 0, 7, 0, 0, 0, 0],
            [6, 0, 0, 1, 9, 5, 0, 0, 0],
            [0, 9, 8, 0, 0, 0, 0, 6, 0],
            [8, 0, 0, 0, 6, 0, 0, 0, 3],
            [4, 0, 0, 8, 0, 3, 0, 0, 1],
            [7, 0, 0, 0, 2, 0, 0, 0, 6],
            [0, 6, 0, 0, 0, 0, 2, 8, 0],
            [0, 0, 0, 4, 1, 9, 0, 0, 5],
            [0, 0, 0, 0, 8, 0, 0, 7, 9]
        ];
        
        const exampleSolution = [
            [5, 3, 4, 6, 7, 8, 9, 1, 2],
            [6, 7, 2, 1, 9, 5, 3, 4, 8],
            [1, 9, 8, 3, 4, 2, 5, 6, 7],
            [8, 5, 9, 7, 6, 1, 4, 2, 3],
            [4, 2, 6, 8, 5, 3, 7, 9, 1],
            [7, 1, 3, 9, 2, 4, 8, 5, 6],
            [9, 6, 1, 5, 3, 7, 2, 8, 4],
            [2, 8, 7, 4, 1, 9, 6, 3, 5],
            [3, 4, 5, 2, 8, 6, 1, 7, 9]
        ];
        
        gameState.board = JSON.parse(JSON.stringify(exampleBoard));
        gameState.solution = JSON.parse(JSON.stringify(exampleSolution));
        gameState.userBoard = JSON.parse(JSON.stringify(exampleBoard));
        gameState.elapsedTime = 0;
        gameState.mistakes = 0;
        gameState.selectedCell = null;
        gameState.hintsUsed = 0;
        
        elements.timer.textContent = '00:00';
        elements.mistakes.textContent = '0';
    }

    // åˆ›å»ºæ£‹ç›˜UI
    function createBoardUI() {
        elements.sudokuBoard.innerHTML = '';
        
        for (let row = 0; row < 9; row++) {
            for (let col = 0; col < 9; col++) {
                const cellValue = gameState.userBoard[row][col];
                const cell = document.createElement('div');
                cell.className = 'cell';
                cell.dataset.row = row;
                cell.dataset.col = col;
                
                // æ·»åŠ åŒºå—è¾¹æ¡†
                if (col % 3 === 2 && col < 8) cell.classList.add('border-right');
                if (row % 3 === 2 && row < 8) cell.classList.add('border-bottom');
                
                // é¢„å¡«å……å•å…ƒæ ¼
                if (cellValue !== 0) {
                    cell.textContent = cellValue;
                    cell.classList.add('prefilled');
                }
                
                // äº‹ä»¶ç›‘å¬
                cell.addEventListener('click', () => selectCell(row, col));
                
                // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
                cell.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // é˜²æ­¢è§¦æ‘¸æ—¶é¡µé¢æ»šåŠ¨
                    selectCell(row, col);
                });
                
                elements.sudokuBoard.appendChild(cell);
            }
        }
    }

    // è®¾ç½®æ•°å­—é€‰æ‹©é¢æ¿
    function setupNumberPad() {
        elements.numberPad.innerHTML = '';
        
        // æ·»åŠ æ•°å­—æŒ‰é’® 1-9
        for (let i = 1; i <= 9; i++) {
            const numBtn = document.createElement('div');
            numBtn.className = 'num-btn';
            numBtn.textContent = i;
            numBtn.dataset.value = i;
            numBtn.addEventListener('click', () => fillCell(i));
            
            // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
            numBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                fillCell(i);
            });
            
            elements.numberPad.appendChild(numBtn);
        }
        
        // æ·»åŠ åˆ é™¤æŒ‰é’®
        const deleteBtn = document.createElement('div');
        deleteBtn.className = 'num-btn';
        deleteBtn.textContent = 'âŒ«';
        deleteBtn.style.fontSize = '1.4rem';
        deleteBtn.addEventListener('click', () => fillCell(0));
        
        // æ·»åŠ è§¦æ‘¸äº‹ä»¶æ”¯æŒ
        deleteBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            fillCell(0);
        });
        
        elements.numberPad.appendChild(deleteBtn);
    }

    // é€‰æ‹©å•å…ƒæ ¼
    function selectCell(row, col) {
        // æ¸…é™¤ä¹‹å‰çš„é€‰æ‹©
        document.querySelectorAll('.cell.selected, .cell.highlighted, .cell.related').forEach(cell => {
            cell.classList.remove('selected', 'highlighted', 'related');
        });
        
        // è·³è¿‡é¢„å¡«å……å•å…ƒæ ¼
        if (gameState.board[row][col] !== 0) return;
        
        // è®¾ç½®æ–°é€‰æ‹©çš„å•å…ƒæ ¼
        const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
        cell.classList.add('selected');
        gameState.selectedCell = { row, col };
        
        // é«˜äº®ç›¸åŒæ•°å­—
        const selectedValue = gameState.userBoard[row][col];
        if (selectedValue !== 0) {
            highlightNumber(selectedValue);
        }
        
        // é«˜äº®ç›¸å…³å•å…ƒæ ¼ï¼ˆè¡Œã€åˆ—ã€å®«ï¼‰
        highlightRelatedCells(row, col);
    }

    // é«˜äº®ç›¸åŒæ•°å­—
    function highlightNumber(number) {
        for (let row = 0; row < 9; row++) {
            for (let col = 0; col < 9; col++) {
                if (gameState.userBoard[row][col] === number) {
                    const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                    cell.classList.add('highlighted');
                }
            }
        }
    }

    // é«˜äº®ç›¸å…³å•å…ƒæ ¼
    function highlightRelatedCells(row, col) {
        // é«˜äº®æ•´è¡Œ
        for (let c = 0; c < 9; c++) {
            if (c !== col) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${c}"]`);
                cell.classList.add('related');
            }
        }
        
        // é«˜äº®æ•´åˆ—
        for (let r = 0; r < 9; r++) {
            if (r !== row) {
                const cell = document.querySelector(`.cell[data-row="${r}"][data-col="${col}"]`);
                cell.classList.add('related');
            }
        }
        
        // é«˜äº®æ‰€åœ¨å®«æ ¼
        const boxRowStart = Math.floor(row / 3) * 3;
        const boxColStart = Math.floor(col / 3) * 3;
        
        for (let r = boxRowStart; r < boxRowStart + 3; r++) {
            for (let c = boxColStart; c < boxColStart + 3; c++) {
                if (r !== row || c !== col) {
                    const cell = document.querySelector(`.cell[data-row="${r}"][data-col="${c}"]`);
                    cell.classList.add('related');
                }
            }
        }
    }

    // å¡«å†™å•å…ƒæ ¼
    function fillCell(value) {
        if (!gameState.selectedCell) return;
        
        const { row, col } = gameState.selectedCell;
        
        // è·³è¿‡é¢„å¡«å……å•å…ƒæ ¼
        if (gameState.board[row][col] !== 0) return;
        
        // æ›´æ–°æ¸¸æˆçŠ¶æ€
        gameState.userBoard[row][col] = value;
        
        // æ›´æ–°UI
        const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
        cell.textContent = value === 0 ? '' : value;
        cell.classList.remove('error');
        
        // æ·»åŠ ç”¨æˆ·è¾“å…¥æ ·å¼
        if (value !== 0) {
            cell.classList.add('user-input');
            
            // éªŒè¯è¾“å…¥æ˜¯å¦æ­£ç¡®
            if (value !== gameState.solution[row][col]) {
                cell.classList.add('error');
                gameState.mistakes++;
                elements.mistakes.textContent = gameState.mistakes;
            }
        } else {
            cell.classList.remove('user-input');
        }
        
        // é«˜äº®ç›¸åŒæ•°å­—
        document.querySelectorAll('.cell.highlighted').forEach(cell => {
            cell.classList.remove('highlighted');
        });
        
        if (value !== 0) {
            highlightNumber(value);
        }
        
        // æ£€æŸ¥æ¸¸æˆæ˜¯å¦å®Œæˆ
        checkGameCompletion();
    }

    // æ£€æŸ¥æ¸¸æˆå®ŒæˆçŠ¶æ€
    function checkGameCompletion() {
        for (let row = 0; row < 9; row++) {
            for (let col = 0; col < 9; col++) {
                if (gameState.userBoard[row][col] === 0) return false;
                if (gameState.userBoard[row][col] !== gameState.solution[row][col]) return false;
            }
        }
        
        // æ¸¸æˆèƒœåˆ©
        clearInterval(gameState.timerInterval);
        alert('æ­å–œï¼ä½ æˆåŠŸå®Œæˆäº†æ•°ç‹¬æŒ‘æˆ˜ï¼');
        
        // è§£é”æˆå°±
        gameState.achievements[gameState.currentSeason] = true;
        if (gameState.mistakes === 0 && gameState.hintsUsed === 0) {
            gameState.achievements.perfect = true;
        }
        
        updateAchievementsUI();
        return true;
    }

    // æ›´æ–°æˆå°±æ˜¾ç¤º
    function updateAchievementsUI() {
        document.querySelectorAll('.badge').forEach(badge => {
            const badgeType = badge.dataset.badge;
            if (gameState.achievements[badgeType]) {
                badge.classList.add('unlocked');
            } else {
                badge.classList.remove('unlocked');
            }
        });
    }

    // å¯åŠ¨è®¡æ—¶å™¨
    function startTimer() {
        if (gameState.timerInterval) {
            clearInterval(gameState.timerInterval);
        }
        
        gameState.startTime = Date.now();
        gameState.timerInterval = setInterval(updateTimer, 1000);
    }

    // æ›´æ–°è®¡æ—¶å™¨æ˜¾ç¤º
    function updateTimer() {
        if (!gameState.startTime) return;
        
        gameState.elapsedTime = Math.floor((Date.now() - gameState.startTime) / 1000);
        const minutes = Math.floor(gameState.elapsedTime / 60).toString().padStart(2, '0');
        const seconds = (gameState.elapsedTime % 60).toString().padStart(2, '0');
        elements.timer.textContent = `${minutes}:${seconds}`;
    }

    // æ›´æ”¹å­£èŠ‚ä¸»é¢˜
    function changeSeason(season) {
        gameState.currentSeason = season;
        const config = seasonsConfig[season];
        
        // æ›´æ–°æ ‡é¢˜
        elements.seasonTitle.textContent = config.title;
        elements.seasonTitle.className = `season-title ${config.class}`;
        
        // æ›´æ–°èƒŒæ™¯
        document.body.style.background = config.bg;
        
        // æ›´æ–°æ´»åŠ¨æŒ‰é’®
        document.querySelectorAll('.season-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.season === season);
        });
        
        // åˆ›å»ºç²’å­ç‰¹æ•ˆ
        createParticles(config.particles);
    }

    // åˆ›å»ºç²’å­ç‰¹æ•ˆ - ç§»åŠ¨ç«¯ä¼˜åŒ–
    function createParticles(particleConfig) {
        elements.particles.innerHTML = '';
        
        // æ ¹æ®å±å¹•å°ºå¯¸è°ƒæ•´ç²’å­æ•°é‡
        const isMobile = window.innerWidth <= 768;
        const amount = isMobile ? Math.floor(particleConfig.amount * 0.6) : particleConfig.amount;
        
        for (let i = 0; i < amount; i++) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = particleConfig.shape;
            particle.style.color = particleConfig.color;
            
            // æ ¹æ®è®¾å¤‡è°ƒæ•´ç²’å­å¤§å°
            const baseSize = isMobile ? 12 : 16;
            particle.style.fontSize = `${Math.random() * baseSize + baseSize}px`;
            particle.style.left = `${Math.random() * 100}%`;
            
            // éšæœºåŠ¨ç”»å»¶è¿Ÿå’ŒæŒç»­æ—¶é—´
            const animationDelay = Math.random() * 10;
            const animationDuration = Math.random() * 20 + 20;
            
            // ç‰¹æ®Šæ•ˆæœ
            if (gameState.currentSeason === 'spring' || gameState.currentSeason === 'autumn') {
                particle.style.animation = `float ${animationDuration}s ease-in-out ${animationDelay}s infinite`;
            } else {
                particle.style.animation = `fall ${animationDuration}s linear ${animationDelay}s infinite`;
            }
            
            // åˆå§‹é€æ˜åº¦
            particle.style.opacity = `${Math.random() * 0.5 + 0.3}`;
            
            elements.particles.appendChild(particle);
        }
    }

    // æç¤ºåŠŸèƒ½
    function provideHint() {
        if (!gameState.selectedCell) return;
        
        const { row, col } = gameState.selectedCell;
        
        // è·å–æ­£ç¡®æ•°å­—
        const correctNum = gameState.solution[row][col];
        
        // å¡«å†™åˆ°å•å…ƒæ ¼
        fillCell(correctNum);
        
        // æ›´æ–°æç¤ºè®¡æ•°
        gameState.hintsUsed++;
    }

    // æ£€æŸ¥æ¸¸æˆé”™è¯¯
    function checkForErrors() {
        let hasErrors = false;
        
        for (let row = 0; row < 9; row++) {
            for (let col = 0; col < 9; col++) {
                const cell = document.querySelector(`.cell[data-row="${row}"][data-col="${col}"]`);
                cell.classList.remove('error');
                
                // ä»…æ£€æŸ¥ç”¨æˆ·å¡«å†™çš„å•å…ƒæ ¼
                if (gameState.board[row][col] === 0 && 
                    gameState.userBoard[row][col] !== gameState.solution[row][col]) {
                    cell.classList.add('error');
                    hasErrors = true;
                }
            }
        }
        
        if (!hasErrors) {
            alert('æ­å–œï¼ç›®å‰æ‰€æœ‰å¡«å†™çš„æ•°å­—éƒ½æ˜¯æ­£ç¡®çš„ï¼');
        }
    }

    // äº‹ä»¶ç›‘å¬ç»‘å®š
    window.addEventListener('load', initGame);
    window.addEventListener('resize', () => {
        // åœ¨çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°ç”Ÿæˆç²’å­ï¼Œä»¥é€‚åº”æ–°å°ºå¯¸
        changeSeason(gameState.currentSeason);
    });
    
    elements.newGameBtn.addEventListener('click', () => {
        if (confirm('ç¡®å®šå¼€å§‹æ–°æ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚')) {
            initGame();
        }
    });
    elements.checkBtn.addEventListener('click', checkForErrors);
    elements.hintBtn.addEventListener('click', provideHint);
    
    // å­£èŠ‚åˆ‡æ¢äº‹ä»¶
    document.querySelectorAll('.season-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            changeSeason(btn.dataset.season);
        });
    });
</script>
